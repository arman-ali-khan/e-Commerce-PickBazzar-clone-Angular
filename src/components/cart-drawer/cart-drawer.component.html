<div
  [class.invisible]="!isCartOpen()"
  class="fixed inset-0 z-[100] transition-all duration-300">
  <!-- Overlay -->
  <div
    (click)="closeCart()"
    [class.opacity-0]="!isCartOpen()"
    class="absolute inset-0 bg-black bg-opacity-50 transition-opacity duration-300">
  </div>
  
  <!-- Drawer -->
  <div
    [class.translate-x-full]="!isCartOpen()"
    class="relative w-full max-w-md ml-auto h-full bg-white shadow-xl flex flex-col transition-transform duration-300 ease-in-out">
    
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        Your Cart ({{ cartCount() }})
      </h2>
      <button (click)="closeCart()" class="text-gray-500 hover:text-gray-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
    </div>

    @if (cartItems().length === 0) {
        <div class="flex-grow flex flex-col items-center justify-center text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mb-4 text-gray-300"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
            <p class="text-lg">Your cart is empty</p>
            <p class="text-sm">Add items to get started</p>
        </div>
    } @else {
      <!-- Items List -->
      <div class="flex-grow overflow-y-auto p-4 space-y-4">
        @for(item of cartItems(); track item.cartItemId) {
          <div class="flex items-start space-x-4">
            <div class="w-20 h-20 rounded-md overflow-hidden flex-shrink-0">
              <img [ngSrc]="item.imageUrl" [alt]="item.name" width="80" height="80" class="w-full h-full object-cover">
            </div>
            <div class="flex-grow">
              <h3 class="font-medium text-gray-800">{{ item.name }}</h3>
              @let variantString = getVariantString(item);
              @if (variantString) {
                <div class="text-xs text-gray-500 capitalize">{{ variantString }}</div>
              }
              <p class="text-sm text-gray-500">{{ item.price | currency }}</p>
              <div class="flex items-center justify-between mt-2">
                <!-- Quantity Controls -->
                <div class="flex items-center border border-gray-200 rounded-full">
                  <button (click)="decrementQuantity(item.cartItemId)" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-l-full">-</button>
                  <span class="px-3 py-1 text-sm font-medium">{{ item.quantity }}</span>
                  <button (click)="incrementQuantity(item.cartItemId)" class="px-3 py-1 text-lg text-gray-600 hover:bg-gray-100 rounded-r-full">+</button>
                </div>
                <!-- Remove Button -->
                <button (click)="removeFromCart(item.cartItemId)" class="text-gray-400 hover:text-red-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Footer -->
      <div class="p-4 border-t bg-gray-50">
        <div class="flex justify-between items-center mb-4">
          <span class="text-lg font-semibold text-gray-800">Subtotal</span>
          <span class="text-xl font-bold text-brand">{{ cartTotal() | currency }}</span>
        </div>
        <a routerLink="/checkout" (click)="closeCart()" class="block text-center w-full bg-brand hover:bg-brand-dark text-white font-bold py-3 px-4 rounded-lg transition-colors">
          Proceed to Checkout
        </a>
      </div>
    }
  </div>
</div>